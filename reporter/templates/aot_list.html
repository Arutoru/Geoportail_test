{% extends 'base.html' %}
  {% load static %}
  {% load leaflet_tags %}
  {% block content1 %}

  <div class="col-2 d-flex flex-column">
    <div class="input-group mb-2">
      <input class="form-control" id="search" type="text" placeholder="Rechercher une AOT" aria-label="Search" onkeyup="searchItem()">
    </div>
    <div class="dropdown d-flex flex-column flex-xl-row mb-2">
      <span class="mx-auto">filtré par :&nbsp;</span>
      <select class="custom-select" id="AOTfiltre" onchange="filtre()">
        <option value="Expiration">Date d'expiration</option>
        <option value="Remarque">Remarque</option>
      </select>
    </div>

    <ul class="list-group" id="expiration">

      <!-- Création des AOT expirés -->
      {% for aot in red %}
      <li class="list-group-item list-group-item-danger d-flex flex-wrap justify-content-between">
        <div>
          <h7>{{aot.amodiataire}}</h7>
          <br>
          <small>{{aot.date_fin|date:"j M Y"}}</small>
        </div>
        <div>
          <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-danger btn-sm">
            <span class="fa fa-search" aria-hidden="true"></span>
          </button>
          <!-- Création des points de notifications pour les remarques -->
          {% for statut in critique %}
            {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
            <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,57,29);"></i>
            {% endif %}
          {% endfor %}
          {% for statut in intermediaire %}
            {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
            <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,170,50);"></i>
            {% endif %}
          {% endfor %}
          {% for statut in bon %}
            {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
            <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(58,180,10);"></i>
            {% endif %}
          {% endfor %}
        </div>
      </li>
      {% endfor %}


      <!-- Création des AOT en attente de facturation -->
      {% for aot in orange %}
      <li class="list-group-item list-group-item-warning d-flex flex-wrap justify-content-between">
        <div>
          <h7>{{aot.amodiataire}}</h7>
          <br>
          <small>{{aot.date_fin|date:"j M Y"}}</small>
        </div>
        <div>
          <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-warning btn-sm">
            <span class="fa fa-search" aria-hidden="true"></span>
          </button>
          <!-- Création des points de notifications pour les remarques -->
          {% for statut in critique %}
            {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
            <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,57,29);"></i>
            {% endif %}
          {% endfor %}
          {% for statut in intermediaire %}
            {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
            <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,170,50);"></i>
            {% endif %}
          {% endfor %}
          {% for statut in bon %}
            {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
            <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(58,180,10)"></i>
            {% endif %}
          {% endfor %}
        </div>
      </li>
      {% endfor %}

      <!-- Création des AOT à jour -->
      {% for aot in green %}
      <li class="list-group-item list-group-item-success d-flex flex-wrap justify-content-between">
        <div>
          <h7>{{aot.amodiataire}}</h7>
          <br>
          <small>{{aot.date_fin|date:"j M Y"}}</small>
        </div>
        <div>
          <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-success btn-sm">
            <span class="fa fa-search" aria-hidden="true"></span>
          </button>
          <!-- Création des points de notifications pour les remarques -->
          {% for statut in critique %}
            {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
            <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,57,29);"></i>
            {% endif %}
          {% endfor %}
          {% for statut in intermediaire %}
            {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
            <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,170,50);"></i>
            {% endif %}
          {% endfor %}
          {% for statut in bon %}
            {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
            <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(58,180,10)"></i>
            {% endif %}
          {% endfor %}
        </div>
      </li>
      {% endfor %}
    </ul>

    <ul class="list-group" id="remarque" style="display: none;">
      <!-- AOT avec remarque critique -->
      {% for statut in critique %}
        {% for aot in red %}
          {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
          <li class="list-group-item list-group-item-danger d-flex flex-wrap justify-content-between">
            <div>
              <h7>{{aot.amodiataire}}</h7>
              <br>
              <small>{{aot.date_fin|date:"j M Y"}}</small>
            </div>
            <div>
              <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-danger btn-sm">
                <span class="fa fa-search" aria-hidden="true"></span>
              </button>
              <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,57,29);"></i>
            </div>
          </li>
          {% endif %}
        {% endfor %}
        {% for aot in orange %}
          {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
          <li class="list-group-item list-group-item-warning d-flex flex-wrap justify-content-between">
            <div>
              <h7>{{aot.amodiataire}}</h7>
              <br>
              <small>{{aot.date_fin|date:"j M Y"}}</small>
            </div>
            <div>
              <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-warning btn-sm">
                <span class="fa fa-search" aria-hidden="true"></span>
              </button>
              <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,57,29);"></i>
            </div>
          </li>
          {% endif %}
        {% endfor %}
        {% for aot in green %}
          {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
          <li class="list-group-item list-group-item-success d-flex flex-wrap justify-content-between">
            <div>
              <h7>{{aot.amodiataire}}</h7>
              <br>
              <small>{{aot.date_fin|date:"j M Y"}}</small>
            </div>
            <div>
              <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-success btn-sm">
                <span class="fa fa-search" aria-hidden="true"></span>
              </button>
              <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,57,29);"></i>
            </div>
          </li>
          {% endif %}
        {% endfor %}
      {% endfor %}

      <!-- AOT avec remarque intermediaire -->
      {% for statut in intermediaire %}
        {% for aot in red %}
          {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
          <li class="list-group-item list-group-item-danger d-flex flex-wrap justify-content-between">
            <div>
              <h7>{{aot.amodiataire}}</h7>
              <br>
              <small>{{aot.date_fin|date:"j M Y"}}</small>
            </div>
            <div>
              <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-danger btn-sm">
                <span class="fa fa-search" aria-hidden="true"></span>
              </button>
              <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,170,50);"></i>
            </div>
          </li>
          {% endif %}
        {% endfor %}
        {% for aot in orange %}
          {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
          <li class="list-group-item list-group-item-warning d-flex flex-wrap justify-content-between">
            <div>
              <h7>{{aot.amodiataire}}</h7>
              <br>
              <small>{{aot.date_fin|date:"j M Y"}}</small>
            </div>
            <div>
              <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-warning btn-sm">
                <span class="fa fa-search" aria-hidden="true"></span>
              </button>
              <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,170,50);"></i>
            </div>
          </li>
          {% endif %}
        {% endfor %}
        {% for aot in green %}
          {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
          <li class="list-group-item list-group-item-success d-flex flex-wrap justify-content-between">
            <div>
              <h7>{{aot.amodiataire}}</h7>
              <br>
              <small>{{aot.date_fin|date:"j M Y"}}</small>
            </div>
            <div>
              <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-success btn-sm">
                <span class="fa fa-search" aria-hidden="true"></span>
              </button>
              <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(255,170,50);"></i>
            </div>
          </li>
          {% endif %}
        {% endfor %}
      {% endfor %}

      <!-- AOT avec remarque bonne -->
      {% for statut in bon %}
        {% for aot in red %}
          {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
          <li class="list-group-item list-group-item-danger d-flex flex-wrap justify-content-between">
            <div>
              <h7>{{aot.amodiataire}}</h7>
              <br>
              <small>{{aot.date_fin|date:"j M Y"}}</small>
            </div>
            <div>
              <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-danger btn-sm">
                <span class="fa fa-search" aria-hidden="true"></span>
              </button>
              <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(58,180,10);"></i>
            </div>
          </li>
          {% endif %}
        {% endfor %}
        {% for aot in orange %}
          {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
          <li class="list-group-item list-group-item-warning d-flex flex-wrap justify-content-between">
            <div>
              <h7>{{aot.amodiataire}}</h7>
              <br>
              <small>{{aot.date_fin|date:"j M Y"}}</small>
            </div>
            <div>
              <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-warning btn-sm">
                <span class="fa fa-search" aria-hidden="true"></span>
              </button>
              <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(58,180,10);"></i>
            </div>
          </li>
          {% endif %}
        {% endfor %}
        {% for aot in green %}
          {% if statut.remarque and statut.amodiataire == aot.amodiataire %}
          <li class="list-group-item list-group-item-success d-flex flex-wrap justify-content-between">
            <div>
              <h7>{{aot.amodiataire}}</h7>
              <br>
              <small>{{aot.date_fin|date:"j M Y"}}</small>
            </div>
            <div>
              <button style="font-size: 0.6rem;" type="button" class="zoom btn btn-outline-success btn-sm">
                <span class="fa fa-search" aria-hidden="true"></span>
              </button>
              <i class="fa fa-exclamation-circle" aria-hidden="true" style="color:rgb(58,180,10);"></i>
            </div>
          </li>
          {% endif %}
        {% endfor %}
      {% endfor %}

    </ul>
  </div>

  <div class="col-10 container" id="map">
    <h2 class = "popup">CARTES DES AMODIATIONS DU PAD</h2>
    {% leaflet_map "detailmap" callback="window.map_init"%}
  </div>

  <!-- Petit resumé de Présentation du projet -->
  <div class="sidebar" id="accordion">
    <div class="card">
      <div class="card-header" id="headingOne">
        <h5 class="mb-0">
          <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
            Présentation du projet
          </button>
        </h5>
      </div>
      <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
        <div class="card-body">
          Ce projet a pour but de permettre la gestion des amodiations attribuées par le port autonome de Douala. La carte ci-contre fournit les détails sur chaque amodiation et permet d'avoir les différentes AOT (Autorisations d'occupations temporaires) sur une carte.
          Chacune des couleurs représente l'état de l'AOT, le rouge pour une AOT qui nécessite une nouvelle facturation, le jaune pour une AOT dont la dernière facture expire bientôt, Le vert pour une AOT dont la dernière facture payée est à jour.
        </div>
      </div>
    </div>

    <!-- Ensemble des images qui se réfèrent au projet -->
    <div class="card">
      <div class="card-header" id="headingImg">
        <h5 class="mb-0">
          <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseImg" aria-expanded="false" aria-controls="collapseThree">
            Acquisition des données
          </button>
        </h5>
      </div>
      <div id="collapseImg" class="collapse" aria-labelledby="headingImg" data-parent="#accordion">
        <div id="carouselIndicators" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
            <li data-target="#carouselIndicators" data-slide-to="0" class="active"></li>
            <li data-target="#carouselIndicators" data-slide-to="1"></li>
            <li data-target="#carouselIndicators" data-slide-to="2"></li>
          </ol>
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img class="d-block w-100" src="{% static "ImgPro1.jpg" %}" alt="First slide">
            </div>
            <div class="carousel-item">
              <img class="d-block w-100" src="{% static "ImgPro2.jpg" %}" alt="Second slide">
            </div>
            <div class="carousel-item">
              <img class="d-block w-100" src="{% static "ImgPro3.jpg" %}" alt="Third slide">
            </div>
          </div>
          <a class="carousel-control-prev" href="#carouselIndicators" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselIndicators" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Légende des couches -->
    <div class="card">
      <div class="card-header" id="headingTwo">
        <h5 class="mb-0 flex-column flex-md-row">
          <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            Liste des couches
          </button>
          <!-- Bouton pour télécharger les couches -->
          {% if user.is_authenticated %}
            <button type="button" id="dwn-btn" class="btn btn-success mx-2">
              Télécharger <span class="fa fa-download fa-1x" aria-hidden="true"></span>
            </button>
          {% else %}
          <button type="button" id="dwn-btn" class="btn btn-success mx-2" disabled>
            Télécharger <span class="fa fa-download fa-1x" aria-hidden="true"></span>
          </button>
          {% endif %}
        </h5>
      </div>
      <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
        <div>
          <small><p class="text-center font-italic">Sélectionnez ci-dessous les couches à télécharger<p></small>
        </div>
        <div class="card-body">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="Region" id="defaultCheck1" checked>
            <label class="form-check-label" for="defaultCheck1">
              AOT
            </label>
            <!-- Définition de la symbologie -->
            <ul style="padding:0">
              <li class="d-flex flex-row"><div class="" style="width:20px; height:20px; background:red;"></div><span>&nbsp;Expiré</span></li>
              <li class="d-flex flex-row"><div class="" style="width:20px; height:20px; background:orange;"></div><span>&nbsp;En cours d'expiration</span></li>
              <li class="d-flex flex-row"><div class="" style="width:20px; height:20px; background:green;"></div><span>&nbsp;A jour</span></li>
            </ul>
          </div>

          <div class="form-check">
            <input  class="form-check-input" type="checkbox" value="Borne" id="defaultCheck2" checked>
            <label class="form-check-label" for="defaultCheck2">
              Compteur
            </label>
            <!-- Définition de la symbologie -->
            <img width="25" src="{% static "Electrical.png" %}" alt="..." class="rounded">
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="Region" id="defaultCheck3" checked>
            <label class="form-check-label" for="defaultCheck3">
              Route
            </label>
            <!-- Définition de la symbologie -->
            <ul style="padding:0">
              <li class="d-flex flex-row"><div class="" style="width:20px; height:15px; border-bottom:4px solid silver;"></div><span>&nbsp;Bitumé</span></li>
              <li class="d-flex flex-row"><div class="" style="width:20px; height:15px; border-bottom:4px solid orange;"></div><span>&nbsp;Non bitumé</span></li>
            </ul>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="Region" id="defaultCheck4" checked>
            <label class="form-check-label" for="defaultCheck4">
              Chemin de fer
            </label>
            <!-- Définition de la symbologie -->
            <div class="" style="width:20px; height:15px; border-bottom:4px solid black;"></div>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="Region" id="defaultCheck5" checked>
            <label class="form-check-label" for="defaultCheck5">
              Réseau Electrique
            </label>
            <!-- Définition de la symbologie -->
            <div class="" style="width:20px; height:15px; border-bottom:3px solid skyblue;"></div>
          </div>

        </div>
      </div>
    </div>

    <!-- Statistiques -->
    <div class="card">
      <div class="card-header" id="headingFour">
        <h5 class="mb-0">
          <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
            Statistiques
          </button>
        </h5>
      </div>
      <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">
        <div class="card-body d-flex flex-column flex-lg-column">
          <div class="mx-auto">
            <div id="stat_aot"></div>
            <ul class="col-12">
              <li class="stat-item">
                <span style="color:rgb(255,57,29);">Expirés:</span> <span id="red">{{red.count}}</span>
              </li>
              <li class="stat-item">
                <span style="color:rgb(255,220,50);">En attente:</span> <span id="orange">{{orange.count}}</span>
              </li>
              <li class="stat-item">
                <span style="color:rgb(76,184,33);">A jour:</span><span id="green">{{green.count}}</span>
              </li>
            </ul>
          </div>
          <div class="mx-auto">
            <div id="stat_cauti"></div>
              <ul style="display:none;">
                {% for cauti in low_caut %}
                  <li class='low'>{{cauti.montant_caution__count}}</li>
                {% endfor %}
                {% for cauti in mid_caut %}
                  <li class='mid'>{{cauti.montant_caution__count}}</li>
                {% endfor %}
                {% for cauti in high_caut %}
                  <li class='high'>{{cauti.montant_caution__count}}</li>
                {% endfor %}
              </ul>
            <div>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header" id="headingFive">
        <h5 class="mb-0">
          <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseFive" aria-expanded="true" aria-controls="collapseFive">
            Outils
          </button>
        </h5>
      </div>
      <div id="collapseFive" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
        <div class="card-body">
          <span>Etiquetage</span>
          <button type="button" id="labelOn" class="btn btn-success mx-2">
            <span class="fa fa-eye" aria-hidden="true"></span>
          </button>
          <button type="button" id="labelOff" class="btn btn-success mx-2">
            <span class="fa fa-eye-slash" aria-hidden="true"></span>
          </button>
          <hr>
          <br>
          <span>Mesure</span>
          <button type="button" id="distance" class="btn btn-success mx-2">
            <svg width="20" height="20">
                <polygon points=" 19,10 1,10" style="fill:none;stroke:white;stroke-width:2.5" />
            </svg>
          </button>
          <button type="button" id="area" class="btn btn-success mx-2">
            <svg width="20" height="20">
                <polygon points=" 16,1 4,1 1,16 19,16" style="fill:none;stroke:white;stroke-width:2.5" />
            </svg>
          </button>
          <hr>
          <br>
          <span>Geolocalisation</span>
          <button type="button" id="geolocation" class="btn btn-success mx-2">
            <span class="fa fa-map-marker" aria-hidden="true"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
  </div>
  {% endblock %}
